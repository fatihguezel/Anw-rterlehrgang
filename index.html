<!DOCTYPE html>
<html lang="de" style="overscroll-behavior-y: contain;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anwärterlehrgang Übungsfragen</title>
    <style>
        :root {
            --primary-color: #4285f4;
            --correct-color: #34a853;
            --wrong-color: #ea4335;
            --text-color: #202124;
            --light-gray: #f1f3f4;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: white;
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            touch-action: pan-y;
            overscroll-behavior-y: contain;
            position: fixed;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        @media (max-width: 600px) {
            body {
                position: absolute;
                padding: 10px;
            }
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-color);
        }

        .name-container, .loading-container {
            text-align: center;
            margin: 40px 0;
            padding: 20px;
        }

        .name-input {
            padding: 10px;
            font-size: 1rem;
            margin: 10px 0;
            width: 100%;
            max-width: 300px;
            border: 1px solid #dadce0;
            border-radius: 4px;
        }

        .quiz-container {
            display: none;
        }

        .progress-counter {
            font-size: 1rem;
            margin-bottom: 20px;
            color: #5f6368;
            text-align: center;
        }

        .question-container {
            margin-bottom: 30px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            padding: 12px 16px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }

        .option-label {
            font-weight: bold;
            margin-right: 10px;
            min-width: 20px;
        }

        .option:hover {
            background-color: var(--light-gray);
        }

        .option.selected {
            border-color: var(--primary-color);
            background-color: #e8f0fe;
        }

        .option.correct {
            background-color: #e6f4ea;
            border-color: var(--correct-color);
        }

        .option.wrong {
            background-color: #fce8e6;
            border-color: var(--wrong-color);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 10px;
        }

        .nav-group {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
            flex: 1;
        }

        #backToOverview {
            display: none;
            background-color: #f1f3f4;
            color: var(--text-color);
        }

        button:hover {
            background-color: #3367d6;
        }

        #backToOverview:hover {
            background-color: #e0e0e0;
        }

        button:disabled {
            background-color: #f1f3f4;
            color: #bdc1c6;
            cursor: not-allowed;
        }

        .submit-btn {
            display: block;
            margin: 30px auto;
            padding: 12px 24px;
            background-color: var(--correct-color);
        }

        .results-container {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .score {
            font-size: 2rem;
            margin: 20px 0;
            color: var(--primary-color);
        }

        .question-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin: 30px 0;
        }

        .question-nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--light-gray);
            cursor: pointer;
        }

        .question-nav-btn.answered {
            background-color: var(--primary-color);
            color: white;
        }

        .question-nav-btn.correct {
            background-color: var(--correct-color);
            color: white;
        }

        .question-nav-btn.wrong {
            background-color: var(--wrong-color);
            color: white;
        }

        @media (max-width: 600px) {
            .question-text {
                font-size: 1.1rem;
            }
            .option {
                padding: 10px 14px;
            }
            button {
                padding: 8px 16px;
            }
            .navigation {
                flex-direction: column;
            }
            .nav-group {
                width: 100%;
            }
            .question-nav-btn {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <h1>Anwärterlehrgang Übungsfragen</h1>

    <div class="name-container" id="nameContainer">
        <h2>Bitte geben Sie Ihren Namen ein</h2>
        <input type="text" id="userName" class="name-input" placeholder="Ihr Name" required>
        <button id="startQuizBtn">Quiz starten</button>
    </div>

    <div class="loading-container" id="loadingContainer">
        <p>Quiz wird geladen...</p>
    </div>

    <div class="quiz-container" id="quizContainer">
        <div class="progress-counter" id="progressCounter">Frage 1 von 30</div>
        
        <div class="question-container">
            <div class="question-text" id="questionText"></div>
            <div class="options-container" id="optionsContainer"></div>
        </div>

<div class="navigation">
    <div class="nav-group nav-group-top">
        <button id="nextBtn">Weiter</button>
    </div>
    <div class="nav-group nav-group-bottom">
        <button id="prevBtn" disabled>Zurück</button>
        <button id="backToOverview">Zurück zur Übersicht</button>
    </div>
</div>

    <div class="results-container" id="resultsContainer">
        <h2>Ergebnis</h2>
        <div class="score" id="scoreDisplay"></div>
        <p>Klicke auf die Fragen unten, um deine Antworten zu überprüfen</p>
        
        <div class="question-nav" id="questionNav"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elemente auswählen
            const nameContainer = document.getElementById('nameContainer');
            const loadingContainer = document.getElementById('loadingContainer');
            const quizContainer = document.getElementById('quizContainer');
            const resultsContainer = document.getElementById('resultsContainer');
            const questionText = document.getElementById('questionText');
            const optionsContainer = document.getElementById('optionsContainer');
            const progressCounter = document.getElementById('progressCounter');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const backToOverviewBtn = document.getElementById('backToOverview');
            const scoreDisplay = document.getElementById('scoreDisplay');
            const questionNav = document.getElementById('questionNav');
            const userNameInput = document.getElementById('userName');
            const startQuizBtn = document.getElementById('startQuizBtn');

            // Variablen
            let questions = [];
            let currentQuestionIndex = 0;
            let selectedQuestions = [];
            let userAnswers = [];
            let quizCompleted = false;
            let userName = '';
            let quizStarted = false;
            let allowUnload = false;

            // Verhindere Seitenneuladen während des Quiz
            window.addEventListener('beforeunload', function(e) {
                if (!allowUnload && quizStarted && !quizCompleted) {
                    e.preventDefault();
                    e.returnValue = 'Das Quiz ist noch nicht abgeschlossen. Möchten Sie die Seite wirklich verlassen?';
                    return e.returnValue;
                }
            });

            // Mobile Schutzfunktionen
            function setupMobileProtection() {
                // Verhindern des Zurück-Buttons auf Android
                if (history.pushState) {
                    history.pushState(null, null, document.URL);
                    window.addEventListener('popstate', function() {
                        if (quizStarted && !quizCompleted) {
                            history.pushState(null, null, document.URL);
                            alert('Bitte beenden Sie das Quiz, bevor Sie die Seite verlassen.');
                        }
                    });
                }

                // Touch-Events kontrollieren
                let startY;
                document.addEventListener('touchstart', function(e) {
                    startY = e.touches[0].clientY;
                }, { passive: true });

                document.addEventListener('touchmove', function(e) {
                    const y = e.touches[0].clientY;
                    // Wenn Nutzer nach unten zieht und am Anfang der Seite ist
                    if (quizStarted && !quizCompleted && (y > startY) && (window.scrollY <= 0)) {
                        e.preventDefault();
                    }
                }, { passive: false });
            }

            // Name eingeben und Quiz starten
            startQuizBtn.addEventListener('click', function() {
                userName = userNameInput.value.trim();
                if (userName === '') {
                    alert('Bitte geben Sie Ihren Namen ein');
                    return;
                }
                
                nameContainer.style.display = 'none';
                loadingContainer.style.display = 'block';
                quizStarted = true;
                setupMobileProtection();
                loadQuizFile();
            });

            // Quiz-Datei laden
            function loadQuizFile() {
                const excelFileUrl = 'fragen.xlsx';
                
                fetch(excelFileUrl)
                    .then(response => {
                        if (!response.ok) throw new Error('Excel-Datei konnte nicht geladen werden');
                        return response.arrayBuffer();
                    })
                    .then(data => {
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        processQuizData(jsonData);
                    })
                    .catch(error => {
                        console.error('Fehler:', error);
                        loadingContainer.innerHTML = '<p>Fehler beim Laden. Bitte Datei überprüfen.</p>';
                    });
            }

            // Quiz-Daten verarbeiten
            function processQuizData(data) {
                questions = data.map(item => {
                    const options = [];
                    if (item['Option a']) options.push({ label: 'A', text: item['Option a'] });
                    if (item['Option b']) options.push({ label: 'B', text: item['Option b'] });
                    if (item['Option c']) options.push({ label: 'C', text: item['Option c'] });

                    return {
                        text: item.Frage,
                        options: options,
                        correctAnswer: item['Richtige Antwort'].toString().toUpperCase()
                    };
                });

                selectedQuestions = getRandomQuestions(questions, 30);
                userAnswers = new Array(selectedQuestions.length).fill(null);
                loadingContainer.style.display = 'none';
                quizContainer.style.display = 'block';
                showQuestion(currentQuestionIndex);
            }

            // Zufällige Fragen auswählen
            function getRandomQuestions(allQuestions, count) {
                const shuffled = [...allQuestions].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count);
            }

            // Frage anzeigen
            function showQuestion(index) {
                if (index < 0 || index >= selectedQuestions.length) return;
                currentQuestionIndex = index;
                const question = selectedQuestions[index];

                progressCounter.textContent = `Frage ${index + 1} von ${selectedQuestions.length}`;
                questionText.textContent = question.text;

                // "Zurück zur Übersicht"-Button nur nach Abschluss anzeigen
                backToOverviewBtn.style.display = quizCompleted ? 'block' : 'none';

                optionsContainer.innerHTML = '';
                question.options.forEach((option, i) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option';
                    
                    if (userAnswers[index] === option.label) {
                        optionElement.classList.add('selected');
                    }
                    if (quizCompleted) {
                        if (option.label === question.correctAnswer) {
                            optionElement.classList.add('correct');
                        } else if (userAnswers[index] === option.label && userAnswers[index] !== question.correctAnswer) {
                            optionElement.classList.add('wrong');
                        }
                    }

                    const labelSpan = document.createElement('span');
                    labelSpan.className = 'option-label';
                    labelSpan.textContent = option.label + ')';
                    
                    const textSpan = document.createElement('span');
                    textSpan.textContent = option.text;

                    optionElement.appendChild(labelSpan);
                    optionElement.appendChild(textSpan);
                    
                    // Nur während des Quiz Klick-Events hinzufügen
                    if (!quizCompleted) {
                        optionElement.addEventListener('click', () => selectOption(option.label));
                    }
                    
                    optionsContainer.appendChild(optionElement);
                });

                prevBtn.disabled = index === 0;
                nextBtn.textContent = index === selectedQuestions.length - 1 ? 'Prüfung abgeben' : 'Weiter';
                nextBtn.disabled = userAnswers[index] === null && !quizCompleted;
            }

            // Antwort auswählen
            function selectOption(optionLabel) {
                if (quizCompleted) return;
                userAnswers[currentQuestionIndex] = optionLabel;
                showQuestion(currentQuestionIndex);
                nextBtn.disabled = false;
            }

            // Zur vorherigen Frage
            prevBtn.addEventListener('click', () => {
                if (currentQuestionIndex > 0) showQuestion(currentQuestionIndex - 1);
            });

            // Zur nächsten Frage oder Quiz abschließen
            nextBtn.addEventListener('click', () => {
                if (currentQuestionIndex < selectedQuestions.length - 1) {
                    showQuestion(currentQuestionIndex + 1);
                } else {
                    submitQuiz();
                }
            });

            // Zurück zur Ergebnisübersicht
            backToOverviewBtn.addEventListener('click', function() {
                quizContainer.style.display = 'none';
                resultsContainer.style.display = 'block';
            });

            // Quiz abschließen
            function submitQuiz() {
                quizCompleted = true;
                allowUnload = true;
                quizContainer.style.display = 'none';
                resultsContainer.style.display = 'block';

                const correctAnswers = selectedQuestions.reduce((count, question, index) => {
                    return count + (userAnswers[index] === question.correctAnswer ? 1 : 0);
                }, 0);

                scoreDisplay.textContent = `${correctAnswers}/${selectedQuestions.length}`;

                // Ergebnisse speichern (hier können Sie die Google Sheets Integration einfügen)
                saveResults(userName, correctAnswers, selectedQuestions.length, userAnswers);

                // Fragen-Navigation erstellen
                questionNav.innerHTML = '';
                selectedQuestions.forEach((question, index) => {
                    const navBtn = document.createElement('div');
                    navBtn.className = 'question-nav-btn';
                    if (userAnswers[index] !== null) {
                        navBtn.classList.add('answered');
                        if (userAnswers[index] === question.correctAnswer) {
                            navBtn.classList.add('correct');
                        } else {
                            navBtn.classList.add('wrong');
                        }
                    }
                    navBtn.textContent = index + 1;
                    navBtn.addEventListener('click', () => {
                        currentQuestionIndex = index;
                        quizContainer.style.display = 'block';
                        resultsContainer.style.display = 'none';
                        showQuestion(index);
                    });
                    questionNav.appendChild(navBtn);
                });
            }

            // Ergebnisse speichern (Platzhalter für Google Sheets Integration)
            function saveResults(name, score, total, answers) {
                console.log('Ergebnisse:', { name, score, total, answers });
                // Hier würde die Google Sheets Integration eingefügt werden
            }
        });
    </script>
</body>
</html>
